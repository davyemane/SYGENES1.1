{% extends 'base_AdminDashboard.html.twig' %}

{% block body %}
<div class="bg-white flex flex-col justify-start items-start ml-64 ml-64 mr-10">
    {% block page_header %}
        <div class="container mt-6 ml-3">
            <h1 class="text-4xl font-semibold text-blue-600">List of students and their marks</h1>
            <p class="text-sm text-gray-600 mt-1">This is where you can find the list of students and marks</p>
        </div>
    {% endblock %}

    <div class="flex flex-wrap mx-2 mt-4">
        <form action="{{ path('list_student_notes') }}" method="GET" class="mb-4 w-full">
            <div class="flex items-center mb-2">
                <label for="name" class="mr-2">Search by Name:</label>
                <input type="text" id="name" name="name" value="{{ currentName }}" class="py-2 px-3 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
            </div>
            <div class="flex items-center mb-2">
                <label for="field" class="mr-2">Filter by Field:</label>
                <select id="field" name="field" class="py-2 px-3 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    <option value="">All Fields</option>
                    {% for field in fields %}
                        <option value="{{ field.id }}" {% if currentField == field.id %}selected{% endif %}>{{ field.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="py-2 px-4 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none">Apply Filters</button>
        </form>

        {% for student in students %}
            <div class="w-full px-2 mb-4 w-96 h-64">
                <div class="bg-white shadow-md rounded-lg overflow-hidden">
                    <div class="p-6 h-full flex flex-col justify-between">
                        <div>
                            <h5 class="text-xl font-semibold mb-2">{{ student.name }}</h5>
                            <h6 class="text-sm text-gray-600 mb-2">StudentID: {{ student.studentID }}</h6>
                            <p class="text-gray-700 mb-2">Field: {{ student.field.name }}</p>
                            <p class="text-gray-700 mb-4">Level: {{ student.level }}</p>
                            <ul class="list-disc pl-3">
                                {% if student.notes is not empty %}
                                    {% for note in student.notes %}
                                        <li class="mb-2">
                                            CC: {{ note.cc }} | TP: {{ note.tp }} | SN: {{ note.sn }}
                                        </li>
                                        <a href="{{ path('add_note', {id: note.id}) }}" class="block py-2 px-3 border border-orange-500 text-orange-500 rounded-md text-sm hover:bg-orange-500 hover:text-white mt-2">
                                            Edit marks
                                        </a>
                                    {% endfor %}
                                {% else %}
                                    <li class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">No notes available for this student.</li>
                                {% endif %}
                            </ul>
                        </div>
                        {# Additional content or actions can be added here #}
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    {% if isPaginated %}
    <div class="flex justify-center mt-4 w-full">
        <nav aria-label="Page navigation">
            <ul class="inline-flex -space-x-px mb-4">
                {% if page != 1 %}
                    <li>
                        <a href="{{ path('list_student_notes', {page: page - 1, nbre: nbre, name: currentName, field: currentField}) }}" class="py-2 px-3 ml-0 leading-tight text-gray-500 bg-white rounded-l-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700">
                            Previous
                        </a>
                    </li>
                {% endif %}

                {% for i in range(1, nbPage + 1) %}
                    <li>
                        <a href="{{ path('list_student_notes', {page: i, nbre: nbre, name: currentName, field: currentField}) }}" class="py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700">
                            {{ i }}
                        </a>
                    </li>
                {% endfor %}

                {% if page != nbPage %}
                    <li>
                        <a href="{{ path('list_student_notes', {page: page + 1, nbre: nbre, name: currentName, field: currentField}) }}" class="py-2 px-3 leading-tight text-gray-500 bg-white rounded-r-lg border border-gray-300 hover:bg-gray-100 hover:text-gray-700">
                            Next
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block head %}
  {% block title %}<title>List of Students</title>{% endblock %}
{% endblock %}
